@layer uiid.globals, uiid.tokens, uiid.components, uiid.utilities;

@import "./css/globals.tokens.css";
@import "./css/colors.tokens.css";
@import "./css/spacing.tokens.css";
@import "./css/forms.tokens.css";

@layer uiid.globals {
  /* Base tokens: colors and mixing percentages */
  :root {
    --white: white;
    --black: black;

    --shade-background: var(--background, var(--white));
    --shade-foreground: var(--black, var(--black));

    /* Percentages for light/dark variants */
    --percentage-accent-light: 35%;
    --percentage-muted-light: 85%;
    --percentage-surface-light: 98%;

    --percentage-accent-dark: 30%;
    --percentage-muted-dark: 65%;
    --percentage-surface-dark: 80%;

    /* Active percentages default to light */
    --percentage-surface: var(--percentage-surface-light);
    --percentage-muted: var(--percentage-muted-light);
    --percentage-accent: var(--percentage-accent-light);

    /* Mixed shades */
    --shade-accent: color-mix(in oklab, var(--shade-foreground), var(--shade-background) var(--percentage-accent));
    --shade-halftone: color-mix(in oklab, var(--shade-foreground), var(--shade-background) 50%);
    --shade-muted: color-mix(in oklab, var(--shade-foreground), var(--shade-background) var(--percentage-muted));
    --shade-surface: color-mix(in oklab, var(--shade-foreground), var(--shade-background) var(--percentage-surface));
  }

  /* Switch based on system preference if no explicit data-theme */
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme]) {
      --percentage-surface: var(--percentage-surface-dark);
      --percentage-muted: var(--percentage-muted-dark);
      --percentage-accent: var(--percentage-accent-dark);

      --shade-background: var(--black);
      --shade-foreground: var(--white);
    }
  }

  /* Explicit theme overrides */
  :root[data-theme="light"] {
    --percentage-surface: var(--percentage-surface-light);
    --percentage-muted: var(--percentage-muted-light);
    --percentage-accent: var(--percentage-accent-light);

    --shade-background: var(--white);
    --shade-foreground: var(--black);
  }

  :root[data-theme="dark"] {
    --percentage-surface: var(--percentage-surface-dark);
    --percentage-muted: var(--percentage-muted-dark);
    --percentage-accent: var(--percentage-accent-dark);

    --shade-background: var(--black);
    --shade-foreground: var(--white);
  }

  html,
  body {
    @media (pointer: fine) {
      overscroll-behavior: none;
    }
  }

  body {
    background-color: var(--shade-background);
    color: var(--shade-foreground);
    font-family: sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  * {
    box-sizing: border-box;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  p {
    margin: 0;
    padding: 0;
  }

  @media (prefers-reduced-motion: no-preference) {
    html {
      interpolate-size: allow-keywords;
    }
  }

  [data-is-popup="true"] {
    transform-origin: var(--globals-transform-origin);
    transition:
      transform var(--globals-transition-timing),
      opacity var(--globals-transition-timing);

    &[data-starting-style],
    &[data-ending-style] {
      opacity: 0;
      transform: scale(var(--globals-transform-scale));
    }

    &[data-instant] {
      transition-duration: 0ms;
    }
  }

  a {
    text-decoration: underline;
    &:hover {
      color: var(--shade-accent);
      text-decoration: none;
    }
  }

  code {
    font-size: 80% !important;
    color: var(--shade-accent);
    padding: 0.25rem 0.5rem;
    margin-inline: 0.125rem;
    background-color: var(--shade-surface);
    border-radius: var(--globals-border-radius);
    border: var(--globals-border-width) solid var(--shade-muted);
  }
}
